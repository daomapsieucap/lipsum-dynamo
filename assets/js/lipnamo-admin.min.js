jQuery(document).ready(function(n){let t=n("#lipnamo-thumbnails");function o(){var e=t.val().trim();return e?e.split(",").map(e=>parseInt(e.trim())).filter(e=>!isNaN(e)):[]}function s(e){e=[...new Set(e)].filter(e=>!isNaN(e));t.val(e.length?e.join(","):"")}n('.lipnamo-input__img input[type="text"]').on("change",function(){n(this).closest("fieldset").find("img").toggle(!!n(this).val())}),n(".lipnamo-upload").each(function(){var e=n(this);let t=e.closest("fieldset").find(".lipnamo-preview__list"),a;e.on("click",function(e){e.preventDefault(),a||((a=wp.media({title:"Choose Images",button:{text:"Choose Images"},multiple:"add",library:{type:"image"}})).on("select",function(){var e=a.state().get("selection").toJSON(),l=t;if(e?.length){let a=o(),n=[];e.forEach((e,t)=>{var i=parseInt(e.id);a.includes(i)||(n.push(i),t=e.alt||"Image "+(t+1),l.append(`
            <li class="lipnamo-preview-item attachment" data-lipnamo-id="${i}">
                <div class="attachment-preview">
                    <div class="thumbnail">
                        <div class="centered">
                            <img src="${e.url}" alt="${t}" class="lipnamo-preview-image" />
                        </div>
                    </div>
                    <button type="button" class="lipnamo-remove-thumbnail button-link attachment-close media-modal-icon" 
                            data-lipnamo-id="${i}" title="Remove image" aria-label="Remove image">
                        <span class="screen-reader-text">Remove</span>
                    </button>
                </div>
            </li>
        `))}),n.length&&s([...a,...n])}}),a.on("open",function(){var e=a,i=o();if(i.length){let t=e.state().get("selection");i.forEach(e=>{e=wp.media.attachment(e);e.fetch(),t.add(e)})}})),a.open()})}),n(document).on("click",".lipnamo-remove-thumbnail",function(e){e.preventDefault();var t,e=parseInt(n(this).data("lipnamo-id")),i=n(this).closest(".lipnamo-preview-item");t=e,s(o().filter(e=>e!==t)),i.fadeOut(300,function(){n(this).remove()})})});