class LipnamoGenerator{constructor(){this.currentStep=1,this.isRunning=!1,this.config={},this.elements={},this.init()}init(){this.cacheElements(),this.bindEvents()}cacheElements(){this.elements={generateBtn:document.querySelector(".lipnamo-generate"),progressBar:document.querySelector(".lipnamo-progress-bar"),progressWrapper:document.querySelector(".lipnamo-progress-wrapper"),progressStep:document.querySelector(".lipnamo-progress-step"),progressTotal:document.querySelector(".lipnamo-progress-total"),progressText:document.querySelector(".lipnamo-progress-text"),wpBody:document.getElementById("wpbody"),stepInput:document.querySelector('input[name="lipnamo-generate__step"]'),postTotal:document.querySelector('input[name="lipnamo_post_total"]'),postType:document.querySelector('select[name="lipnamo_post_type"]'),postAuthor:document.querySelector('select[name="lipnamo_post_author"]'),postStatus:document.querySelector('select[name="lipnamo_post_status"]'),postThumbnails:document.querySelector('input[name="lipnamo_thumbnails"]'),titleMin:document.querySelector('input[name="length_title_min"]'),titleMax:document.querySelector('input[name="length_title_max"]'),excerptMin:document.querySelector('input[name="length_excerpt_min"]'),excerptMax:document.querySelector('input[name="length_excerpt_max"]'),bodyMin:document.querySelector('input[name="length_content_min"]'),bodyMax:document.querySelector('input[name="length_content_max"]')}}bindEvents(){this.elements.generateBtn&&this.elements.generateBtn.addEventListener("click",e=>{e.preventDefault(),this.startGeneration()})}getFormConfig(){return{postTotal:parseInt(this.elements.postTotal?.value)||0,postType:this.elements.postType?.value||"",postAuthor:this.elements.postAuthor?.value||"",postStatus:this.elements.postStatus?.value||"",postThumbnails:this.elements.postThumbnails?.value||"",postTitleLength:`${this.elements.titleMin?.value||""},`+(this.elements.titleMax?.value||""),postExcerptLength:`${this.elements.excerptMin?.value||""},`+(this.elements.excerptMax?.value||""),postBodyLength:`${this.elements.bodyMin?.value||""},`+(this.elements.bodyMax?.value||"")}}startGeneration(){this.isRunning||(this.config=this.getFormConfig(),this.currentStep=1,this.isRunning=!0,this.showProgress(),this.elements.progressTotal&&(this.elements.progressTotal.textContent=this.config.postTotal),this.lipnamoGenerateItems())}showProgress(){this.elements.wpBody&&this.elements.wpBody.classList.add("lipnamo-loading"),this.elements.progressWrapper&&(this.elements.progressWrapper.style.display="block"),this.elements.generateBtn&&this.elements.generateBtn.classList.add("disabled")}hideProgress(){this.elements.wpBody&&this.elements.wpBody.classList.remove("lipnamo-loading"),this.elements.generateBtn&&this.elements.generateBtn.classList.remove("disabled"),this.isRunning=!1}updateProgress(e,t){t=Math.min(100*e/t,100);this.elements.progressStep&&(this.elements.progressStep.textContent=e),this.elements.stepInput&&(this.elements.stepInput.value=e),this.elements.progressBar&&this.animateProgressBar(t)}animateProgressBar(e){let s=this.elements.progressBar,n=parseFloat(s.style.width)||0,o=e,r=150,i=performance.now(),a=e=>{var e=e-i,e=Math.min(e/r,1),t=1-Math.pow(1-e,3),t=n+(o-n)*t;s.style.width=t+"%",e<1&&requestAnimationFrame(a)};requestAnimationFrame(a)}lipnamoGenerateItems(){var e;this.currentStep>this.config.postTotal?this.hideProgress():((e=new FormData).append("action","lipnamo_generate_items"),e.append("lipnamo_ajax_nonce",lipnamo_items.ajax_nonce),e.append("post_total",this.config.postTotal),e.append("post_type",this.config.postType),e.append("post_author",this.config.postAuthor),e.append("post_status",this.config.postStatus),e.append("post_thumbnails",this.config.postThumbnails),e.append("post_title_length",this.config.postTitleLength),e.append("post_excerpt_length",this.config.postExcerptLength),e.append("post_body_length",this.config.postBodyLength),e.append("post_step",this.currentStep),fetch(lipnamo_items.ajax_url,{method:"POST",body:e,credentials:"same-origin"}).then(e=>{if(e.ok)return e.text();throw new Error("HTTP error! status: "+e.status)}).then(e=>this.handleSuccess(e)).catch(e=>this.handleError(e)))}handleSuccess(e){try{var t=JSON.parse(e),s=parseInt(t.step)||this.currentStep;this.updateProgress(s,this.config.postTotal),s>=this.config.postTotal?(this.elements.progressText&&(this.elements.progressText.textContent=t.message||"Generation completed!"),this.hideProgress()):(this.currentStep=s+1,setTimeout(()=>{this.isRunning&&this.lipnamoGenerateItems()},100))}catch(e){console.error("LipnamoGenerator: Error parsing response",e),this.handleError(e)}}handleError(e){console.error("LipnamoGenerator: Error",e),this.elements.progressText&&(this.elements.progressText.textContent="An error occurred during generation. Please try again."),this.hideProgress()}stop(){this.isRunning=!1,this.hideProgress()}reset(){this.stop(),this.currentStep=1,this.elements.progressBar&&(this.elements.progressBar.style.width="0%"),this.elements.progressStep&&(this.elements.progressStep.textContent="0"),this.elements.progressText&&(this.elements.progressText.textContent=""),this.elements.stepInput&&(this.elements.stepInput.value="")}getStatus(){return{isRunning:this.isRunning,currentStep:this.currentStep,totalSteps:this.config.postTotal}}}document.addEventListener("DOMContentLoaded",function(){new LipnamoGenerator});